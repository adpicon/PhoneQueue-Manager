<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Phone Queue â€“ Simple</title>
  <style>
    body{
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:#eef2f6 url('ffc1efb7-3c31-4ff6-b8cf-a52e85bb3421.jpg') repeat;
      background-size:220px;
      margin:0;
    }
    .overlay{background:rgba(255,255,255,0.9);min-height:100vh;}
    .container{max-width:1000px;margin:0 auto;padding:16px}
    h1{margin:0 0 8px 0;text-align:center}
    .toolbar{display:flex;gap:8px;justify-content:center;margin-bottom:12px}
    .btn{border:1px solid #cbd5e1;background:#fff;border-radius:14px;padding:8px 12px;cursor:pointer}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}
    .panel{background:#fff;border-radius:16px;box-shadow:0 1px 3px rgba(2,6,23,.1)}
    .panel-h{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #e2e8f0;padding:10px 14px}
    .panel-b{padding:10px 14px}
    .row{display:grid;grid-template-columns:auto 1fr auto;align-items:center;border:2px solid #000;border-radius:8px;padding:8px 10px;margin-bottom:8px;background:#fff}
    .name{font-weight:600}
    .status{font-size:12px;text-align:right}
    .status.online{color:#16a34a;}
    .status.oncall{color:#dc2626;}
    .row .btn{padding:4px 8px;border-radius:10px}
    .empty{font-size:12px;color:#64748b}
    label{display:block;font-size:12px;font-weight:600;margin-bottom:4px}
    input{width:100%;box-sizing:border-box;border:1px solid #cbd5e1;border-radius:12px;padding:8px 10px}
    .form{display:grid;grid-template-columns:1fr auto;gap:8px;margin-top:8px}
  </style>
</head>
<body>
  <div class="overlay">
    <div class="container">
      <h1>Phone Queue Simulator</h1>
      <div class="toolbar">
        <button class="btn" id="start-next">Call next</button>
        <button class="btn" id="reset">Reset</button>
      </div>

      <div class="grid">
        <div class="panel">
          <div class="panel-h"><div style="font-weight:700">Available</div><div id="count-available">0</div></div>
          <div class="panel-b" id="list-available"></div>
          <div class="panel-b">
            <div class="form">
              <div>
                <label>Engineer name</label>
                <input id="new-name" placeholder="Jane Doe" />
              </div>
              <button class="btn" id="add">Add</button>
            </div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-h"><div style="font-weight:700">On Call</div><div id="count-oncall">0</div></div>
          <div class="panel-b" id="list-oncall"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const KEY = 'phone-queue-simple-v1';
    const uid = () => Math.random().toString(36).slice(2,9);

    const state = { agents: [] }; // {id,name,status:'available'|'oncall', since:number}

    function save(){ localStorage.setItem(KEY, JSON.stringify(state)); }
    function load(){
      const raw = localStorage.getItem(KEY);
      if(!raw) return; try{ const s = JSON.parse(raw); if(Array.isArray(s.agents)) state.agents = s.agents; }catch{}
    }

    function fmt(ms){
      const sec = Math.max(0, Math.floor(ms/1000));
      const h = String(Math.floor(sec/3600)).padStart(2,'0');
      const m = String(Math.floor((sec%3600)/60)).padStart(2,'0');
      const s = String(sec%60).padStart(2,'0');
      return `${h}:${m}:${s}`;
    }

    function render(){
      const avail = state.agents.filter(a=>a.status==='available');
      const oncall = state.agents.filter(a=>a.status==='oncall');
      document.getElementById('count-available').textContent = avail.length;
      document.getElementById('count-oncall').textContent = oncall.length;

      const la = document.getElementById('list-available');
      la.innerHTML = '';
      if(avail.length===0){ la.innerHTML = '<div class="empty">No engineers available.</div>'; }
      avail.forEach(a=>{
        const div = document.createElement('div');
        div.className = 'row';
        const since = Date.now() - a.since;
        div.innerHTML = `
          <div class="name">${a.name}</div>
          <div></div>
          <div class="status online">Online - <span data-timer="${a.id}">${fmt(since)}</span></div>
        `;
        const btn = document.createElement('button');
        btn.className = 'btn';
        btn.textContent = 'Call';
        btn.onclick = ()=>startCall(a.id);
        div.children[1].appendChild(btn);
        la.appendChild(div);
      });

      const lc = document.getElementById('list-oncall');
      lc.innerHTML = '';
      if(oncall.length===0){ lc.innerHTML = '<div class="empty">No active calls.</div>'; }
      oncall.forEach(a=>{
        const div = document.createElement('div');
        div.className = 'row';
        const since = Date.now() - a.since;
        div.innerHTML = `
          <div class="name">${a.name}</div>
          <div></div>
          <div class="status oncall">On Call - <span data-timer="${a.id}">${fmt(since)}</span></div>
        `;
        const btn = document.createElement('button');
        btn.className = 'btn';
        btn.textContent = 'End';
        btn.onclick = ()=>endCall(a.id);
        div.children[1].appendChild(btn);
        lc.appendChild(div);
      });

      document.getElementById('start-next').disabled = avail.length===0;
    }

    function tick(){
      document.querySelectorAll('[data-timer]').forEach(span=>{
        const id = span.getAttribute('data-timer');
        const a = state.agents.find(x=>x.id===id);
        if(!a) return; span.textContent = fmt(Date.now()-a.since);
      });
    }

    function addAgent(){
      const input = document.getElementById('new-name');
      const name = input.value.trim(); if(!name) return;
      state.agents.push({ id: uid(), name, status:'available', since: Date.now() });
      input.value=''; save(); render();
    }

    function startCall(id){
      const idx = state.agents.findIndex(a=>a.id===id && a.status==='available');
      if(idx===-1) return;
      state.agents[idx].status = 'oncall';
      state.agents[idx].since = Date.now();
      save(); render();
    }

    function endCall(id){
      const idx = state.agents.findIndex(a=>a.id===id && a.status==='oncall');
      if(idx===-1) return;
      const agent = state.agents[idx];
      state.agents.splice(idx,1);
      state.agents.push({ id: agent.id, name: agent.name, status:'available', since: Date.now() });
      save(); render();
    }

    function startNext(){
      const a = state.agents.find(x=>x.status==='available');
      if(!a) return; startCall(a.id);
    }

    function resetAll(){ if(confirm('Clear all data?')){ state.agents=[]; save(); render(); } }

    load(); render();
    setInterval(tick, 1000);

    document.getElementById('add').onclick = addAgent;
    document.getElementById('start-next').onclick = startNext;
    document.getElementById('reset').onclick = resetAll;
  </script>
</body>
</html>
